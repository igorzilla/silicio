/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

draw2d.Workflow=function(id){if(!id){return;}this.gridWidthX=10;this.gridWidthY=10;this.snapToGridHelper=null;this.verticalSnapToHelperLine=null;this.horizontalSnapToHelperLine=null;this.figures=new draw2d.ArrayList();this.lines=new draw2d.ArrayList();this.commonPorts=new draw2d.ArrayList();this.dropTargets=new draw2d.ArrayList();this.compartments=new draw2d.ArrayList();this.selectionListeners=new draw2d.ArrayList();this.dialogs=new draw2d.ArrayList();this.toolPalette=null;this.dragging=false;this.tooltip=null;this.draggingLine=null;this.commandStack=new draw2d.CommandStack();this.oldScrollPosLeft=0;this.oldScrollPosTop=0;this.currentSelection=null;this.currentMenu=null;this.connectionLine=new draw2d.Line();this.resizeHandleStart=new draw2d.LineStartResizeHandle(this);this.resizeHandleEnd=new draw2d.LineEndResizeHandle(this);this.resizeHandle1=new draw2d.ResizeHandle(this,1);this.resizeHandle2=new draw2d.ResizeHandle(this,2);this.resizeHandle3=new draw2d.ResizeHandle(this,3);this.resizeHandle4=new draw2d.ResizeHandle(this,4);this.resizeHandle5=new draw2d.ResizeHandle(this,5);this.resizeHandle6=new draw2d.ResizeHandle(this,6);this.resizeHandle7=new draw2d.ResizeHandle(this,7);this.resizeHandle8=new draw2d.ResizeHandle(this,8);this.resizeHandleHalfWidth=parseInt(this.resizeHandle2.getWidth()/2);draw2d.Canvas.call(this,id);this.setPanning(false);if(this.html!=null){this.html.style.backgroundImage="url(grid_10.png)";oThis=this;this.html.tabIndex="0";var _1b5c=function(){var _1b5d=arguments[0]||window.event;var diffX=_1b5d.clientX;var diffY=_1b5d.clientY;var _1b60=oThis.getScrollLeft();var _1b61=oThis.getScrollTop();var _1b62=oThis.getAbsoluteX();var _1b63=oThis.getAbsoluteY();if(oThis.getBestFigure(diffX+_1b60-_1b62,diffY+_1b61-_1b63)!=null){return;}var line=oThis.getBestLine(diffX+_1b60-_1b62,diffY+_1b61-_1b63,null);if(line!=null){line.onContextMenu(diffX+_1b60-_1b62,diffY+_1b61-_1b63);}else{oThis.onContextMenu(diffX+_1b60-_1b62,diffY+_1b61-_1b63);}};this.html.oncontextmenu=function(){return false;};var oThis=this;var _1b66=function(event){var ctrl=event.ctrlKey;oThis.onKeyDown(event.keyCode,ctrl);};var _1b69=function(){var _1b6a=arguments[0]||window.event;var diffX=_1b6a.clientX;var diffY=_1b6a.clientY;var _1b6d=oThis.getScrollLeft();var _1b6e=oThis.getScrollTop();var _1b6f=oThis.getAbsoluteX();var _1b70=oThis.getAbsoluteY();oThis.onMouseDown(diffX+_1b6d-_1b6f,diffY+_1b6e-_1b70);};var _1b71=function(){var _1b72=arguments[0]||window.event;if(oThis.currentMenu!=null){oThis.removeFigure(oThis.currentMenu);oThis.currentMenu=null;}if(_1b72.button==2){return;}var diffX=_1b72.clientX;var diffY=_1b72.clientY;var _1b75=oThis.getScrollLeft();var _1b76=oThis.getScrollTop();var _1b77=oThis.getAbsoluteX();var _1b78=oThis.getAbsoluteY();oThis.onMouseUp(diffX+_1b75-_1b77,diffY+_1b76-_1b78);};var _1b79=function(){var _1b7a=arguments[0]||window.event;var diffX=_1b7a.clientX;var diffY=_1b7a.clientY;var _1b7d=oThis.getScrollLeft();var _1b7e=oThis.getScrollTop();var _1b7f=oThis.getAbsoluteX();var _1b80=oThis.getAbsoluteY();oThis.currentMouseX=diffX+_1b7d-_1b7f;oThis.currentMouseY=diffY+_1b7e-_1b80;var obj=oThis.getBestFigure(oThis.currentMouseX,oThis.currentMouseY);if(draw2d.Drag.currentHover!=null&&obj==null){var _1b82=new draw2d.DragDropEvent();_1b82.initDragDropEvent("mouseleave",false,oThis);draw2d.Drag.currentHover.dispatchEvent(_1b82);}else{var diffX=_1b7a.clientX;var diffY=_1b7a.clientY;var _1b7d=oThis.getScrollLeft();var _1b7e=oThis.getScrollTop();var _1b7f=oThis.getAbsoluteX();var _1b80=oThis.getAbsoluteY();oThis.onMouseMove(diffX+_1b7d-_1b7f,diffY+_1b7e-_1b80);}if(obj==null){draw2d.Drag.currentHover=null;}if(oThis.tooltip!=null){if(Math.abs(oThis.currentTooltipX-oThis.currentMouseX)>10||Math.abs(oThis.currentTooltipY-oThis.currentMouseY)>10){oThis.showTooltip(null);}}};var _1b83=function(_1b84){var _1b84=arguments[0]||window.event;var diffX=_1b84.clientX;var diffY=_1b84.clientY;var _1b87=oThis.getScrollLeft();var _1b88=oThis.getScrollTop();var _1b89=oThis.getAbsoluteX();var _1b8a=oThis.getAbsoluteY();var line=oThis.getBestLine(diffX+_1b87-_1b89,diffY+_1b88-_1b8a,null);if(line!=null){line.onDoubleClick();}};if(this.html.addEventListener){this.html.addEventListener("contextmenu",_1b5c,false);this.html.addEventListener("mousemove",_1b79,false);this.html.addEventListener("mouseup",_1b71,false);this.html.addEventListener("mousedown",_1b69,false);this.html.addEventListener("keydown",_1b66,false);this.html.addEventListener("dblclick",_1b83,false);}else{if(this.html.attachEvent){this.html.attachEvent("oncontextmenu",_1b5c);this.html.attachEvent("onmousemove",_1b79);this.html.attachEvent("onmousedown",_1b69);this.html.attachEvent("onmouseup",_1b71);this.html.attachEvent("onkeydown",_1b66);this.html.attachEvent("ondblclick",_1b83);}else{throw new Error("Open-jACOB Draw2D not supported in this browser.");}}}};draw2d.Workflow.prototype=new draw2d.Canvas;draw2d.Workflow.prototype.type="Workflow";draw2d.Workflow.COLOR_GREEN=new draw2d.Color(0,255,0);draw2d.Workflow.prototype.onScroll=function(){var _1b8c=this.getScrollLeft();var _1b8d=this.getScrollTop();var _1b8e=_1b8c-this.oldScrollPosLeft;var _1b8f=_1b8d-this.oldScrollPosTop;for(var i=0;i<this.figures.getSize();i++){var _1b91=this.figures.get(i);if(_1b91.hasFixedPosition&&_1b91.hasFixedPosition()==true){_1b91.setPosition(_1b91.getX()+_1b8e,_1b91.getY()+_1b8f);}}this.oldScrollPosLeft=_1b8c;this.oldScrollPosTop=_1b8d;};draw2d.Workflow.prototype.setPanning=function(flag){this.panning=flag;if(flag){this.html.style.cursor="move";}else{this.html.style.cursor="default";}};draw2d.Workflow.prototype.scrollTo=function(x,y,fast){if(fast){this.scrollArea.scrollLeft=x;this.scrollArea.scrollTop=y;}else{var steps=40;var xStep=(x-this.getScrollLeft())/steps;var yStep=(y-this.getScrollTop())/steps;var oldX=this.getScrollLeft();var oldY=this.getScrollTop();for(var i=0;i<steps;i++){this.scrollArea.scrollLeft=oldX+(xStep*i);this.scrollArea.scrollTop=oldY+(yStep*i);}}};draw2d.Workflow.prototype.showTooltip=function(_1b9c,_1b9d){if(this.tooltip!=null){this.removeFigure(this.tooltip);this.tooltip=null;if(this.tooltipTimer>=0){window.clearTimeout(this.tooltipTimer);this.tooltipTimer=-1;}}this.tooltip=_1b9c;if(this.tooltip!=null){this.currentTooltipX=this.currentMouseX;this.currentTooltipY=this.currentMouseY;this.addFigure(this.tooltip,this.currentTooltipX+10,this.currentTooltipY+10);var oThis=this;var _1b9f=function(){oThis.tooltipTimer=-1;oThis.showTooltip(null);};if(_1b9d==true){this.tooltipTimer=window.setTimeout(_1b9f,5000);}}};draw2d.Workflow.prototype.showDialog=function(_1ba0,xPos,yPos){if(xPos){this.addFigure(_1ba0,xPos,yPos);}else{this.addFigure(_1ba0,200,100);}this.dialogs.add(_1ba0);};draw2d.Workflow.prototype.showMenu=function(menu,xPos,yPos){if(this.menu!=null){this.html.removeChild(this.menu.getHTMLElement());this.menu.setWorkflow();}this.menu=menu;if(this.menu!=null){this.menu.setWorkflow(this);this.menu.setPosition(xPos,yPos);this.html.appendChild(this.menu.getHTMLElement());this.menu.paint();}};draw2d.Workflow.prototype.onContextMenu=function(x,y){var menu=this.getContextMenu();if(menu!=null){this.showMenu(menu,x,y);}};draw2d.Workflow.prototype.getContextMenu=function(){return null;};draw2d.Workflow.prototype.setToolWindow=function(_1ba9,x,y){this.toolPalette=_1ba9;if(y){this.addFigure(_1ba9,x,y);}else{this.addFigure(_1ba9,20,20);}this.dialogs.add(_1ba9);};draw2d.Workflow.prototype.setSnapToGrid=function(flag){if(flag){this.snapToGridHelper=new draw2d.SnapToGrid(this);}else{this.snapToGridHelper=null;}};draw2d.Workflow.prototype.setSnapToGeometry=function(flag){if(flag){this.snapToGeometryHelper=new draw2d.SnapToGeometry(this);}else{this.snapToGeometryHelper=null;}};draw2d.Workflow.prototype.setGridWidth=function(dx,dy){this.gridWidthX=dx;this.gridWidthY=dy;};draw2d.Workflow.prototype.addFigure=function(_1bb0,xPos,yPos){draw2d.Canvas.prototype.addFigure.call(this,_1bb0,xPos,yPos,true);_1bb0.setWorkflow(this);var _1bb3=this;if(_1bb0 instanceof draw2d.CompartmentFigure){this.compartments.add(_1bb0);}if(_1bb0 instanceof draw2d.Line){this.lines.add(_1bb0);}else{this.figures.add(_1bb0);_1bb0.draggable.addEventListener("dragend",function(_1bb4){});_1bb0.draggable.addEventListener("dragstart",function(_1bb5){var _1bb6=_1bb3.getFigure(_1bb5.target.element.id);if(_1bb6==null){return;}if(_1bb6.isSelectable()==false){return;}_1bb3.showResizeHandles(_1bb6);_1bb3.setCurrentSelection(_1bb6);});_1bb0.draggable.addEventListener("drag",function(_1bb7){var _1bb8=_1bb3.getFigure(_1bb7.target.element.id);if(_1bb8==null){return;}if(_1bb8.isSelectable()==false){return;}_1bb3.moveResizeHandles(_1bb8);});}_1bb0.paint();this.setDocumentDirty();};draw2d.Workflow.prototype.removeFigure=function(_1bb9){draw2d.Canvas.prototype.removeFigure.call(this,_1bb9);this.figures.remove(_1bb9);this.lines.remove(_1bb9);this.dialogs.remove(_1bb9);_1bb9.setWorkflow(null);if(_1bb9 instanceof draw2d.CompartmentFigure){this.compartments.remove(_1bb9);}if(_1bb9 instanceof draw2d.Connection){_1bb9.disconnect();}if(this.currentSelection==_1bb9){this.setCurrentSelection(null);}this.setDocumentDirty();};draw2d.Workflow.prototype.moveFront=function(_1bba){this.html.removeChild(_1bba.getHTMLElement());this.html.appendChild(_1bba.getHTMLElement());};draw2d.Workflow.prototype.moveBack=function(_1bbb){this.html.removeChild(_1bbb.getHTMLElement());this.html.insertBefore(_1bbb.getHTMLElement(),this.html.firstChild);};draw2d.Workflow.prototype.getBestCompartmentFigure=function(x,y,_1bbe){var _1bbf=null;for(var i=0;i<this.figures.getSize();i++){var _1bc1=this.figures.get(i);if((_1bc1 instanceof draw2d.CompartmentFigure)&&_1bc1.isOver(x,y)==true&&_1bc1!=_1bbe){if(_1bbf==null){_1bbf=_1bc1;}else{if(_1bbf.getZOrder()<_1bc1.getZOrder()){_1bbf=_1bc1;}}}}return _1bbf;};draw2d.Workflow.prototype.getBestFigure=function(x,y,_1bc4){var _1bc5=null;for(var i=0;i<this.figures.getSize();i++){var _1bc7=this.figures.get(i);if(_1bc7.isOver(x,y)==true&&_1bc7!=_1bc4){if(_1bc5==null){_1bc5=_1bc7;}else{if(_1bc5.getZOrder()<_1bc7.getZOrder()){_1bc5=_1bc7;}}}}return _1bc5;};draw2d.Workflow.prototype.getBestLine=function(x,y,_1bca){var _1bcb=null;for(var i=0;i<this.lines.getSize();i++){var line=this.lines.get(i);if(line.containsPoint(x,y)==true&&line!=_1bca){if(_1bcb==null){_1bcb=line;}else{if(_1bcb.getZOrder()<line.getZOrder()){_1bcb=line;}}}}return _1bcb;};draw2d.Workflow.prototype.getFigure=function(id){for(var i=0;i<this.figures.getSize();i++){var _1bd0=this.figures.get(i);if(_1bd0.id==id){return _1bd0;}}return null;};draw2d.Workflow.prototype.getFigures=function(){return this.figures;};draw2d.Workflow.prototype.getDocument=function(){return new draw2d.Document(this);};draw2d.Workflow.prototype.addSelectionListener=function(w){this.selectionListeners.add(w);};draw2d.Workflow.prototype.removeSelectionListener=function(w){this.selectionListeners.remove(w);};draw2d.Workflow.prototype.setCurrentSelection=function(_1bd3){if(_1bd3==null){this.hideResizeHandles();this.hideLineResizeHandles();}this.currentSelection=_1bd3;for(var i=0;i<this.selectionListeners.getSize();i++){var w=this.selectionListeners.get(i);if(w!=null&&w.onSelectionChanged){w.onSelectionChanged(this.currentSelection);}}};draw2d.Workflow.prototype.getCurrentSelection=function(){return this.currentSelection;};draw2d.Workflow.prototype.getLines=function(){return this.lines;};draw2d.Workflow.prototype.registerPort=function(port){port.draggable.targets=this.dropTargets;this.commonPorts.add(port);this.dropTargets.add(port.dropable);};draw2d.Workflow.prototype.unregisterPort=function(port){port.draggable.targets=null;this.commonPorts.remove(port);this.dropTargets.remove(port.dropable);};draw2d.Workflow.prototype.getCommandStack=function(){return this.commandStack;};draw2d.Workflow.prototype.showConnectionLine=function(x1,y1,x2,y2){this.connectionLine.setStartPoint(x1,y1);this.connectionLine.setEndPoint(x2,y2);if(this.connectionLine.canvas==null){draw2d.Canvas.prototype.addFigure.call(this,this.connectionLine);}};draw2d.Workflow.prototype.hideConnectionLine=function(){if(this.connectionLine.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.connectionLine);}};draw2d.Workflow.prototype.showLineResizeHandles=function(_1bdc){var _1bdd=this.resizeHandleStart.getWidth()/2;var _1bde=this.resizeHandleStart.getHeight()/2;var _1bdf=_1bdc.getStartPoint();var _1be0=_1bdc.getEndPoint();draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandleStart,_1bdf.x-_1bdd,_1bdf.y-_1bdd);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandleEnd,_1be0.x-_1bdd,_1be0.y-_1bdd);this.resizeHandleStart.setCanDrag(_1bdc.isResizeable());this.resizeHandleEnd.setCanDrag(_1bdc.isResizeable());if(_1bdc.isResizeable()){this.resizeHandleStart.setBackgroundColor(draw2d.Workflow.COLOR_GREEN);this.resizeHandleEnd.setBackgroundColor(draw2d.Workflow.COLOR_GREEN);this.resizeHandleStart.draggable.targets=this.dropTargets;this.resizeHandleEnd.draggable.targets=this.dropTargets;}else{this.resizeHandleStart.setBackgroundColor(null);this.resizeHandleEnd.setBackgroundColor(null);}};draw2d.Workflow.prototype.hideLineResizeHandles=function(){if(this.resizeHandleStart.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandleStart);}if(this.resizeHandleEnd.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandleEnd);}};draw2d.Workflow.prototype.showResizeHandles=function(_1be1){this.hideLineResizeHandles();this.hideResizeHandles();if(this.getEnableSmoothFigureHandling()==true&&this.getCurrentSelection()!=_1be1){this.resizeHandle1.setAlpha(0.01);this.resizeHandle2.setAlpha(0.01);this.resizeHandle3.setAlpha(0.01);this.resizeHandle4.setAlpha(0.01);this.resizeHandle5.setAlpha(0.01);this.resizeHandle6.setAlpha(0.01);this.resizeHandle7.setAlpha(0.01);this.resizeHandle8.setAlpha(0.01);}var _1be2=this.resizeHandle1.getWidth();var _1be3=this.resizeHandle1.getHeight();var _1be4=_1be1.getHeight();var _1be5=_1be1.getWidth();var xPos=_1be1.getX();var yPos=_1be1.getY();draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle1,xPos-_1be2,yPos-_1be3);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle3,xPos+_1be5,yPos-_1be3);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle5,xPos+_1be5,yPos+_1be4);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle7,xPos-_1be2,yPos+_1be4);this.moveFront(this.resizeHandle1);this.moveFront(this.resizeHandle3);this.moveFront(this.resizeHandle5);this.moveFront(this.resizeHandle7);this.resizeHandle1.setCanDrag(_1be1.isResizeable());this.resizeHandle3.setCanDrag(_1be1.isResizeable());this.resizeHandle5.setCanDrag(_1be1.isResizeable());this.resizeHandle7.setCanDrag(_1be1.isResizeable());if(_1be1.isResizeable()){var green=new draw2d.Color(0,255,0);this.resizeHandle1.setBackgroundColor(green);this.resizeHandle3.setBackgroundColor(green);this.resizeHandle5.setBackgroundColor(green);this.resizeHandle7.setBackgroundColor(green);}else{this.resizeHandle1.setBackgroundColor(null);this.resizeHandle3.setBackgroundColor(null);this.resizeHandle5.setBackgroundColor(null);this.resizeHandle7.setBackgroundColor(null);}if(_1be1.isStrechable()&&_1be1.isResizeable()){this.resizeHandle2.setCanDrag(_1be1.isResizeable());this.resizeHandle4.setCanDrag(_1be1.isResizeable());this.resizeHandle6.setCanDrag(_1be1.isResizeable());this.resizeHandle8.setCanDrag(_1be1.isResizeable());draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle2,xPos+(_1be5/2)-this.resizeHandleHalfWidth,yPos-_1be3);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle4,xPos+_1be5,yPos+(_1be4/2)-(_1be3/2));draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle6,xPos+(_1be5/2)-this.resizeHandleHalfWidth,yPos+_1be4);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle8,xPos-_1be2,yPos+(_1be4/2)-(_1be3/2));this.moveFront(this.resizeHandle2);this.moveFront(this.resizeHandle4);this.moveFront(this.resizeHandle6);this.moveFront(this.resizeHandle8);}};draw2d.Workflow.prototype.hideResizeHandles=function(){if(this.resizeHandle1.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle1);}if(this.resizeHandle2.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle2);}if(this.resizeHandle3.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle3);}if(this.resizeHandle4.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle4);}if(this.resizeHandle5.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle5);}if(this.resizeHandle6.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle6);}if(this.resizeHandle7.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle7);}if(this.resizeHandle8.canvas!=null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle8);}};draw2d.Workflow.prototype.moveResizeHandles=function(_1be9){var _1bea=this.resizeHandle1.getWidth();var _1beb=this.resizeHandle1.getHeight();var _1bec=_1be9.getHeight();var _1bed=_1be9.getWidth();var xPos=_1be9.getX();var yPos=_1be9.getY();this.resizeHandle1.setPosition(xPos-_1bea,yPos-_1beb);this.resizeHandle3.setPosition(xPos+_1bed,yPos-_1beb);this.resizeHandle5.setPosition(xPos+_1bed,yPos+_1bec);this.resizeHandle7.setPosition(xPos-_1bea,yPos+_1bec);if(_1be9.isStrechable()){this.resizeHandle2.setPosition(xPos+(_1bed/2)-this.resizeHandleHalfWidth,yPos-_1beb);this.resizeHandle4.setPosition(xPos+_1bed,yPos+(_1bec/2)-(_1beb/2));this.resizeHandle6.setPosition(xPos+(_1bed/2)-this.resizeHandleHalfWidth,yPos+_1bec);this.resizeHandle8.setPosition(xPos-_1bea,yPos+(_1bec/2)-(_1beb/2));}};draw2d.Workflow.prototype.onMouseDown=function(x,y){this.dragging=true;this.mouseDownPosX=x;this.mouseDownPosY=y;if(this.toolPalette!=null&&this.toolPalette.getActiveTool()!=null){this.toolPalette.getActiveTool().execute(x,y);}this.setCurrentSelection(null);this.showMenu(null);var size=this.getLines().getSize();for(var i=0;i<size;i++){var line=this.lines.get(i);if(line.containsPoint(x,y)&&line.isSelectable()){this.hideResizeHandles();this.setCurrentSelection(line);this.showLineResizeHandles(this.currentSelection);if(line instanceof draw2d.Line&&!(line instanceof draw2d.Connection)){this.draggingLine=line;}break;}}};draw2d.Workflow.prototype.onMouseUp=function(x,y){this.dragging=false;this.draggingLine=null;};draw2d.Workflow.prototype.onMouseMove=function(x,y){if(this.dragging==true&&this.draggingLine!=null){var diffX=x-this.mouseDownPosX;var diffY=y-this.mouseDownPosY;this.draggingLine.startX=this.draggingLine.getStartX()+diffX;this.draggingLine.startY=this.draggingLine.getStartY()+diffY;this.draggingLine.setEndPoint(this.draggingLine.getEndX()+diffX,this.draggingLine.getEndY()+diffY);this.mouseDownPosX=x;this.mouseDownPosY=y;this.showLineResizeHandles(this.currentSelection);}else{if(this.dragging==true&&this.panning==true){var diffX=x-this.mouseDownPosX;var diffY=y-this.mouseDownPosY;this.scrollTo(this.getScrollLeft()-diffX,this.getScrollTop()-diffY,true);this.onScroll();}}};draw2d.Workflow.prototype.onKeyDown=function(_1bfb,ctrl){if(_1bfb==46&&this.currentSelection!=null&&this.currentSelection.isDeleteable()){this.commandStack.execute(new draw2d.CommandDelete(this.currentSelection));}else{if(_1bfb==90&&ctrl){this.commandStack.undo();}else{if(_1bfb==89&&ctrl){this.commandStack.redo();}}}};draw2d.Workflow.prototype.setDocumentDirty=function(){for(var i=0;i<this.dialogs.getSize();i++){var d=this.dialogs.get(i);if(d!=null&&d.onSetDocumentDirty){d.onSetDocumentDirty();}}if(this.snapToGeometryHelper!=null){this.snapToGeometryHelper.onSetDocumentDirty();}if(this.snapToGridHelper!=null){this.snapToGridHelper.onSetDocumentDirty();}};draw2d.Workflow.prototype.snapToHelper=function(_1bff,pos){if(this.snapToGeometryHelper!=null){if(_1bff instanceof draw2d.ResizeHandle){var _1c01=_1bff.getSnapToGridAnchor();pos.x+=_1c01.x;pos.y+=_1c01.y;var _1c02=new draw2d.Point(pos.x,pos.y);var _1c03=_1bff.getSnapToDirection();var _1c04=this.snapToGeometryHelper.snapPoint(_1c03,pos,_1c02);if((_1c03&draw2d.SnapToHelper.EAST_WEST)&&!(_1c04&draw2d.SnapToHelper.EAST_WEST)){this.showSnapToHelperLineVertical(_1c02.x);}else{this.hideSnapToHelperLineVertical();}if((_1c03&draw2d.SnapToHelper.NORTH_SOUTH)&&!(_1c04&draw2d.SnapToHelper.NORTH_SOUTH)){this.showSnapToHelperLineHorizontal(_1c02.y);}else{this.hideSnapToHelperLineHorizontal();}_1c02.x-=_1c01.x;_1c02.y-=_1c01.y;return _1c02;}else{var _1c05=new draw2d.Dimension(pos.x,pos.y,_1bff.getWidth(),_1bff.getHeight());var _1c02=new draw2d.Dimension(pos.x,pos.y,_1bff.getWidth(),_1bff.getHeight());var _1c03=draw2d.SnapToHelper.NSEW;var _1c04=this.snapToGeometryHelper.snapRectangle(_1c05,_1c02);if((_1c03&draw2d.SnapToHelper.WEST)&&!(_1c04&draw2d.SnapToHelper.WEST)){this.showSnapToHelperLineVertical(_1c02.x);}else{if((_1c03&draw2d.SnapToHelper.EAST)&&!(_1c04&draw2d.SnapToHelper.EAST)){this.showSnapToHelperLineVertical(_1c02.getX()+_1c02.getWidth());}else{this.hideSnapToHelperLineVertical();}}if((_1c03&draw2d.SnapToHelper.NORTH)&&!(_1c04&draw2d.SnapToHelper.NORTH)){this.showSnapToHelperLineHorizontal(_1c02.y);}else{if((_1c03&draw2d.SnapToHelper.SOUTH)&&!(_1c04&draw2d.SnapToHelper.SOUTH)){this.showSnapToHelperLineHorizontal(_1c02.getY()+_1c02.getHeight());}else{this.hideSnapToHelperLineHorizontal();}}return _1c02.getTopLeft();}}else{if(this.snapToGridHelper!=null){var _1c01=_1bff.getSnapToGridAnchor();pos.x=pos.x+_1c01.x;pos.y=pos.y+_1c01.y;var _1c02=new draw2d.Point(pos.x,pos.y);this.snapToGridHelper.snapPoint(0,pos,_1c02);_1c02.x=_1c02.x-_1c01.x;_1c02.y=_1c02.y-_1c01.y;return _1c02;}}return pos;};draw2d.Workflow.prototype.showSnapToHelperLineHorizontal=function(_1c06){if(this.horizontalSnapToHelperLine==null){this.horizontalSnapToHelperLine=new draw2d.Line();this.horizontalSnapToHelperLine.setColor(new draw2d.Color(175,175,255));this.addFigure(this.horizontalSnapToHelperLine);}this.horizontalSnapToHelperLine.setStartPoint(0,_1c06);this.horizontalSnapToHelperLine.setEndPoint(this.getWidth(),_1c06);};draw2d.Workflow.prototype.showSnapToHelperLineVertical=function(_1c07){if(this.verticalSnapToHelperLine==null){this.verticalSnapToHelperLine=new draw2d.Line();this.verticalSnapToHelperLine.setColor(new draw2d.Color(175,175,255));this.addFigure(this.verticalSnapToHelperLine);}this.verticalSnapToHelperLine.setStartPoint(_1c07,0);this.verticalSnapToHelperLine.setEndPoint(_1c07,this.getHeight());};draw2d.Workflow.prototype.hideSnapToHelperLines=function(){this.hideSnapToHelperLineHorizontal();this.hideSnapToHelperLineVertical();};draw2d.Workflow.prototype.hideSnapToHelperLineHorizontal=function(){if(this.horizontalSnapToHelperLine!=null){this.removeFigure(this.horizontalSnapToHelperLine);this.horizontalSnapToHelperLine=null;}};draw2d.Workflow.prototype.hideSnapToHelperLineVertical=function(){if(this.verticalSnapToHelperLine!=null){this.removeFigure(this.verticalSnapToHelperLine);this.verticalSnapToHelperLine=null;}};