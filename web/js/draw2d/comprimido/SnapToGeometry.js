/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

draw2d.SnapToGeometry=function(_1af2){draw2d.SnapToHelper.call(this,_1af2);};draw2d.SnapToGeometry.prototype=new draw2d.SnapToHelper;draw2d.SnapToGeometry.THRESHOLD=5;draw2d.SnapToGeometry.prototype.snapPoint=function(_1af3,_1af4,_1af5){if(this.rows==null||this.cols==null){this.populateRowsAndCols();}if((_1af3&draw2d.SnapToHelper.EAST)!=0){var _1af6=this.getCorrectionFor(this.cols,_1af4.getX()-1,1);if(_1af6!=draw2d.SnapToGeometry.THRESHOLD){_1af3&=~draw2d.SnapToHelper.EAST;_1af5.x+=_1af6;}}if((_1af3&draw2d.SnapToHelper.WEST)!=0){var _1af7=this.getCorrectionFor(this.cols,_1af4.getX(),-1);if(_1af7!=draw2d.SnapToGeometry.THRESHOLD){_1af3&=~draw2d.SnapToHelper.WEST;_1af5.x+=_1af7;}}if((_1af3&draw2d.SnapToHelper.SOUTH)!=0){var _1af8=this.getCorrectionFor(this.rows,_1af4.getY()-1,1);if(_1af8!=draw2d.SnapToGeometry.THRESHOLD){_1af3&=~draw2d.SnapToHelper.SOUTH;_1af5.y+=_1af8;}}if((_1af3&draw2d.SnapToHelper.NORTH)!=0){var _1af9=this.getCorrectionFor(this.rows,_1af4.getY(),-1);if(_1af9!=draw2d.SnapToGeometry.THRESHOLD){_1af3&=~draw2d.SnapToHelper.NORTH;_1af5.y+=_1af9;}}return _1af3;};draw2d.SnapToGeometry.prototype.snapRectangle=function(_1afa,_1afb){var _1afc=_1afa.getTopLeft();var _1afd=_1afa.getBottomRight();var _1afe=this.snapPoint(draw2d.SnapToHelper.NORTH_WEST,_1afa.getTopLeft(),_1afc);_1afb.x=_1afc.x;_1afb.y=_1afc.y;var _1aff=this.snapPoint(draw2d.SnapToHelper.SOUTH_EAST,_1afa.getBottomRight(),_1afd);if(_1afe&draw2d.SnapToHelper.WEST){_1afb.x=_1afd.x-_1afa.getWidth();}if(_1afe&draw2d.SnapToHelper.NORTH){_1afb.y=_1afd.y-_1afa.getHeight();}return _1afe|_1aff;};draw2d.SnapToGeometry.prototype.populateRowsAndCols=function(){this.rows=new Array();this.cols=new Array();var _1b00=this.workflow.getDocument().getFigures();var index=0;for(var i=0;i<_1b00.getSize();i++){var _1b03=_1b00.get(i);if(_1b03!=this.workflow.getCurrentSelection()){var _1b04=_1b03.getBounds();this.cols[index*3]=new draw2d.SnapToGeometryEntry(-1,_1b04.getX());this.rows[index*3]=new draw2d.SnapToGeometryEntry(-1,_1b04.getY());this.cols[index*3+1]=new draw2d.SnapToGeometryEntry(0,_1b04.x+(_1b04.getWidth()-1)/2);this.rows[index*3+1]=new draw2d.SnapToGeometryEntry(0,_1b04.y+(_1b04.getHeight()-1)/2);this.cols[index*3+2]=new draw2d.SnapToGeometryEntry(1,_1b04.getRight()-1);this.rows[index*3+2]=new draw2d.SnapToGeometryEntry(1,_1b04.getBottom()-1);index++;}}};draw2d.SnapToGeometry.prototype.getCorrectionFor=function(_1b05,value,side){var _1b08=draw2d.SnapToGeometry.THRESHOLD;var _1b09=draw2d.SnapToGeometry.THRESHOLD;for(var i=0;i<_1b05.length;i++){var entry=_1b05[i];var _1b0c;if(entry.type==-1&&side!=0){_1b0c=Math.abs(value-entry.location);if(_1b0c<_1b08){_1b08=_1b0c;_1b09=entry.location-value;}}else{if(entry.type==0&&side==0){_1b0c=Math.abs(value-entry.location);if(_1b0c<_1b08){_1b08=_1b0c;_1b09=entry.location-value;}}else{if(entry.type==1&&side!=0){_1b0c=Math.abs(value-entry.location);if(_1b0c<_1b08){_1b08=_1b0c;_1b09=entry.location-value;}}}}}return _1b09;};draw2d.SnapToGeometry.prototype.onSetDocumentDirty=function(){this.rows=null;this.cols=null;};